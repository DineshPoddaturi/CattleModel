########################################################
if(i > 3){
  
  # if(quantities_prices_capK$ps[i] > quantities_prices_capK$ps[i-1]){
  #   ps <- (quantities_prices_capK$ps[i] + quantities_prices_capK$ps[i-1] + quantities_prices_capK$ps[i-2])/3
  # }
  # if(quantities_prices_capK$pc[i] > quantities_prices_capK$pc[i-1]){
  #   pc <- (quantities_prices_capK$pc[i] + quantities_prices_capK$pc[i-1] + quantities_prices_capK$pc[i-2])/3
  # }
  
  if(quantities_prices_capK$ps[i] < quantities_prices_capK$ps[i-1]){
    ps <- mean(c(quantities_prices_capK$ps[i], quantities_prices_capK$ps[i-1], quantities_prices_capK$ps[i-2],quantities_prices_capK$ps[i-3]))
  }
  if(quantities_prices_capK$pc[i] < quantities_prices_capK$pc[i-1]){
    pc <- mean(c(quantities_prices_capK$pc[i], quantities_prices_capK$pc[i-1], quantities_prices_capK$pc[i-2],quantities_prices_capK$pc[i-3]))
  }
  
  if(quantities_prices_capK$ps[i] > quantities_prices_capK$ps[i-1]){
    ps <- mean(c(quantities_prices_capK$ps[i], quantities_prices_capK$ps[i-1], quantities_prices_capK$ps[i-2],quantities_prices_capK$ps[i-3]))
  }
  if(quantities_prices_capK$pc[i] > quantities_prices_capK$pc[i-1]){
    pc <- mean(c(quantities_prices_capK$pc[i], quantities_prices_capK$pc[i-1], quantities_prices_capK$pc[i-2],quantities_prices_capK$pc[i-3]))
  }
}

ps_lo <- ps - 0.02492
pc_lo <- pc - 0.03717
ps_expected_lo <- ps_expected - 0.1

ps_up <- ps + 0.23644
pc_up <- pc + 0.192417
ps_expected_up <- ps_expected + 0.1

# > estObsPC
# Year cullPrice        pc           D
# 1  2001 0.5017870 0.4100000  0.09178700
# 2  2002 0.5174800 0.3741667  0.14331333
# 3  2003 0.5393250 0.4295833  0.10974167
# 4  2004 0.5356730 0.5055000  0.03017300
# 5  2005 0.5419789 0.5205833  0.02139556
# 6  2006 0.5640260 0.4674167  0.09660933
# 7  2007 0.5931889 0.4811667  0.11202222
# 8  2008 0.6232260 0.5080000  0.11522600
# 9  2009 0.6465220 0.4485000  0.19802200
# 10 2010 0.6594230 0.5493333  0.11008967
# 11 2011 0.6600630 0.7157500 -0.05568700
# 12 2012 0.6420370 0.8197500 -0.17771300
# 13 2013 0.6625070 0.8229167 -0.16040967
# 14 2014 0.7211500 1.0822500 -0.36110000
# 15 2015 0.7990830 1.0410833 -0.24200033
# 16 2016 0.0000000 0.7489167 -0.74891667
# 17 2017 0.0000000 0.6955833 -0.69558333

# estObsPS
# Year  fedPrice        ps          err
# 1  2001 0.7856324 0.7496667  0.035965697
# 2  2002 0.8726021 0.7012500  0.171352125
# 3  2003 0.9384342 0.8450000  0.093434167
# 4  2004 0.9140052 0.8968333  0.017171833
# 5  2005 0.9294725 0.9408333 -0.011360833
# 6  2006 0.9746378 0.9204167  0.054221167
# 7  2007 1.0231970 0.9538333  0.069363667
# 8  2008 1.0738967 0.9446667  0.129230000
# 9  2009 1.1372110 0.8533333  0.283877667
# 10 2010 1.1644190 0.9723333  0.192085667
# 11 2011 1.1763780 1.1716667  0.004711333
# 12 2012 1.1545020 1.2308333 -0.076331333
# 13 2013 1.1674820 1.2633333 -0.095851333
# 14 2014 1.2219400 1.5433333 -0.321393333
# 15 2015 1.2934820 1.4933333 -0.199851333
# 16 2016 0.0000000 1.2166667 -1.216666667
# 17 2017 0.0000000 1.2191667 -1.219166667
#################################################
A_node <- A * dShockNode

if(norm(x = (c_cull - c_old_cull), type = "f") < 0.003 && norm(x = (c_fed - c_old_fed) , type = "f") < 0.003){
  break
}

ps_lo <- ps - 0.02492
pc_lo <- pc - 0.03717
ps_expected_lo <- ps_expected - 0.1

ps_up <- ps + 0.23644
pc_up <- pc + 0.192417
ps_expected_up <- ps_expected + 0.1

# > estObsPS
# Year  fedPrice        ps         err
# 1  2001 0.5666303 0.7496667 -0.18303633
# 2  2002 0.6315664 0.7012500 -0.06968363
# 3  2003 0.8615493 0.8450000  0.01654933
# 4  2004 0.6297460 0.8968333 -0.26708733
# 5  2005 0.7301623 0.9408333 -0.21067105
# 6  2006 0.8156200 0.9204167 -0.10479667
# 7  2007 0.8357997 0.9538333 -0.11803364
# 8  2008 0.8871271 0.9446667 -0.05753958
# 9  2009 0.9609652 0.8533333  0.10763185
# 10 2010 0.9959653 0.9723333  0.02363200
# 11 2011 0.9888048 1.1716667 -0.18286185
# 12 2012 0.9974485 1.2308333 -0.23338483
# 13 2013 1.0320987 1.2633333 -0.23123461
# 14 2014 1.0962301 1.5433333 -0.44710321
# 15 2015 1.1570067 1.4933333 -0.33632664
# 16 2016 0.0000000 1.2166667 -1.21666667
# 17 2017 0.0000000 1.2191667 -1.21916667

# estObsPC
# Year cullPrice        pc           D
# 1  2001 0.2200167 0.4100000 -0.18998333
# 2  2002 0.3478125 0.3741667 -0.02635417
# 3  2003 0.3292900 0.4295833 -0.10029333
# 4  2004 0.3773250 0.5055000 -0.12817500
# 5  2005 0.3292325 0.5205833 -0.19135083
# 6  2006 0.3712980 0.4674167 -0.09611867
# 7  2007 0.4153233 0.4811667 -0.06584333
# 8  2008 0.4569933 0.5080000 -0.05100667
# 9  2009 0.5027120 0.4485000  0.05421200
# 10 2010 0.4516667 0.5493333 -0.09766667
# 11 2011 0.5080300 0.7157500 -0.20772000
# 12 2012 0.4170267 0.8197500 -0.40272333
# 13 2013 0.4668200 0.8229167 -0.35609667
# 14 2014 0.5415080 1.0822500 -0.54074200
# 15 2015 0.5930275 1.0410833 -0.44805583
# 16 2016 0.0000000 0.7489167 -0.74891667
# 17 2017 0.0000000 0.6955833 -0.69558333
###################################################


if(norm(x = (c_cull - c_old_cull), type = "f") < 0.003 && norm(x = (c_fed - c_old_fed) , type = "f") < 0.003){
  break
}

sl_node <- fedCattleNode 
cl_node <- cullCowNode  
A_node <- (sl_node + cl_node) * dShockNode

ps_lo <- ps - 0.27667
pc_lo <- pc - 0.29217
ps_expected_lo <- ps_expected - 0.1

ps_up <- ps + 0.23644
pc_up <- pc + 0.192417
ps_expected_up <- ps_expected + 0.1

# estObsPS
# Year  fedPrice        ps          err
# 1  2001 0.7898185 0.7496667  0.040151833
# 2  2002 0.8865030 0.7012500  0.185253000
# 3  2003 0.9344192 0.8450000  0.089419200
# 4  2004 0.9138228 0.8968333  0.016989467
# 5  2005 0.9257900 0.9408333 -0.015043333
# 6  2006 0.9717058 0.9204167  0.051289133
# 7  2007 1.0199467 0.9538333  0.066113417
# 8  2008 1.0681480 0.9446667  0.123481333
# 9  2009 1.1372110 0.8533333  0.283877667
# 10 2010 1.1644190 0.9723333  0.192085667
# 11 2011 1.1763780 1.1716667  0.004711333
# 12 2012 1.1545020 1.2308333 -0.076331333
# 13 2013 1.1674820 1.2633333 -0.095851333
# 14 2014 1.2219400 1.5433333 -0.321393333
# 15 2015 1.2934820 1.4933333 -0.199851333
# 16 2016 0.0000000 1.2166667 -1.216666667
# 17 2017 0.0000000 1.2191667 -1.219166667

# estObsPC
# Year cullPrice        pc           D
# 1  2001  0.289875 0.4100000 -0.12012500
# 2  2002  0.302290 0.3741667 -0.07187667
# 3  2003  0.329290 0.4295833 -0.10029333
# 4  2004  0.320395 0.5055000 -0.18510500
# 5  2005  0.328995 0.5205833 -0.19158833
# 6  2006  0.348355 0.4674167 -0.11906167
# 7  2007  0.379935 0.4811667 -0.10123167
# 8  2008  0.407585 0.5080000 -0.10041500
# 9  2009  0.430895 0.4485000 -0.01760500
# 10 2010  0.443790 0.5493333 -0.10554333
# 11 2011  0.444415 0.7157500 -0.27133500
# 12 2012  0.426395 0.8197500 -0.39335500
# 13 2013  0.446875 0.8229167 -0.37604167
# 14 2014  0.505520 1.0822500 -0.57673000
# 15 2015  0.583455 1.0410833 -0.45762833
# 16 2016  0.000000 0.7489167 -0.74891667
# 17 2017  0.000000 0.6955833 -0.69558333

##############################################

ps_lo <- ps - 0.27667
pc_lo <- pc - 0.28000
ps_expected_lo <- ps_expected - 0.1

ps_up <- ps + 0.23644
pc_up <- pc + 0.25933
ps_expected_up <- ps_expected + 0.1

# estObsPS
# Year  fedPrice        ps          err
# 1  2001 0.7115428 0.7496667 -0.038123848
# 2  2002 0.9019090 0.7012500  0.200659000
# 3  2003 0.9564400 0.8450000  0.111440000
# 4  2004 0.9275860 0.8968333  0.030752667
# 5  2005 0.9457320 0.9408333  0.004898667
# 6  2006 0.9904190 0.9204167  0.070002333
# 7  2007 1.0346280 0.9538333  0.080794667
# 8  2008 1.0824190 0.9446667  0.137752333
# 9  2009 1.1372110 0.8533333  0.283877667
# 10 2010 1.1644190 0.9723333  0.192085667
# 11 2011 1.1763780 1.1716667  0.004711333
# 12 2012 1.1545020 1.2308333 -0.076331333
# 13 2013 1.1674820 1.2633333 -0.095851333
# 14 2014 1.2219400 1.5433333 -0.321393333
# 15 2015 1.2934820 1.4933333 -0.199851333
# 16 2016 0.0000000 1.2166667 -1.216666667
# 17 2017 0.0000000 1.2191667 -1.219166667

# estObsPC
# Year cullPrice        pc           D
# 1  2001  0.329415 0.4100000 -0.08058500
# 2  2002  0.341835 0.3741667 -0.03233167
# 3  2003  0.368835 0.4295833 -0.06074833
# 4  2004  0.359935 0.5055000 -0.14556500
# 5  2005  0.368535 0.5205833 -0.15204833
# 6  2006  0.387895 0.4674167 -0.07952167
# 7  2007  0.419475 0.4811667 -0.06169167
# 8  2008  0.447125 0.5080000 -0.06087500
# 9  2009  0.470435 0.4485000  0.02193500
# 10 2010  0.483335 0.5493333 -0.06599833
# 11 2011  0.483955 0.7157500 -0.23179500
# 12 2012  0.465935 0.8197500 -0.35381500
# 13 2013  0.486415 0.8229167 -0.33650167
# 14 2014  0.545065 1.0822500 -0.53718500
# 15 2015  0.622995 1.0410833 -0.41808833
# 16 2016  0.000000 0.7489167 -0.74891667
# 17 2017  0.000000 0.6955833 -0.69558333

################################################

ps_lo <- ps - 0.32417
pc_lo <- pc - 0.386667
ps_expected_lo <- ps_expected - 0.1

ps_up <- ps + 0.10929
pc_up <- pc + 0.192417
ps_expected_up <- ps_expected + 0.1





